**Online anomaly detection in quantum device calibration streams**

---

## 1. Problem

Superconducting and other quantum processors require frequent calibration to maintain acceptable coherence times and gate fidelities. Each calibration cycle exposes a collection of hardware parameters‚Äîsuch as T‚ÇÅ, T‚ÇÇ, single- and two-qubit gate error rates, and readout errors‚Äîthat evolve over time due to noise, temperature fluctuations, crosstalk, and hardware ageing.

In practice, these calibration parameters are often:

- monitored one metric at a time,
- inspected using static tolerance bands (e.g., ‚Äúalert if T‚ÇÅ < threshold‚Äù),
- visualised via dashboards that provide limited support for multivariate analysis or adaptive behaviour.

This raises a simple question:

> **Can a lightweight multivariate online anomaly detector provide a more adaptive and informative view of quantum calibration drift than static, metric-wise thresholds?**

This repository provides a small, reproducible prototype to explore that question on both **synthetic calibration streams** and **real calibration snapshots** obtained via Qiskit.

---

## 2. Method

### 2.1 Data: synthetic and real calibration streams

The project treats quantum device calibration as a **multivariate time series**. Each timestamp is a vector of calibration parameters across multiple qubits.

Two data sources are supported:

- **Synthetic calibration data**  
  - Generated by `src/generate_calibration_data.py`.  
  - Simulates T‚ÇÅ, T‚ÇÇ, gate error, and readout error for a configurable number of qubits.  
  - Injects controlled anomalies (e.g., sudden drops in T‚ÇÅ/T‚ÇÇ or spikes in error rates) to stress-test detectors and support visual inspection.

- **Real calibration snapshots (Qiskit)**  
  - Collected by `src/fetch_real_calibration_data.py`.  
  - Uses `qiskit-ibm-runtime` to query an IBM Quantum backend for:
    - T‚ÇÅ and T‚ÇÇ per qubit,
    - readout error per qubit,
    - single-qubit gate error for a chosen gate (e.g., `x`).  
  - Each execution appends a new timestamped row to `data/real_calibration_stream.csv`, allowing users to build a real calibration log over time (e.g., by running the script periodically).

Both sources use the same downstream anomaly detection and visualisation pipeline.

---

### 2.2 Online anomaly detector (Mahalanobis)

The main detector is implemented in `src/online_model.py` and is designed to be:

- **Online/streaming**: processes the calibration time series sequentially;
- **Multivariate**: accounts for correlations across calibration parameters;
- **Lightweight**: suitable for rapid prototyping and potential integration.

Core components:

1. **Sliding window** of recent calibration vectors (size configurable).
2. Estimation of **mean** and **covariance** on that window.
3. Computation of the **squared Mahalanobis distance** of the latest observation from the estimated distribution.
4. Maintenance of a short history of Mahalanobis distances and computation of an **adaptive threshold** as a high percentile (based on a target contamination rate).

A point is flagged as anomalous if its Mahalanobis distance exceeds this adaptive threshold. This yields an online, data-driven boundary between ‚Äúbackground‚Äù calibration variation and atypical behaviour.

---

### 2.3 Baseline detectors

To contextualise the behaviour of the online multivariate model, we implement two simple baselines on a selected scalar metric (e.g., `T1_q0`):

1. **Static ¬±k¬∑œÉ threshold**  
   - Given an empirical mean Œº and standard deviation œÉ of the metric, a point is flagged if it lies outside `[Œº ‚àí kœÉ, Œº + kœÉ]`.  
   - The parameter `k` can be adjusted in the UI.

2. **|z|-score threshold**  
   - The metric is normalised to a z-score `z = (x ‚àí Œº) / œÉ`.  
   - A point is flagged if `|z|` exceeds a given threshold `z_thresh`.

These baselines represent typical ‚Äúrule-of-thumb‚Äù monitoring strategies and serve as comparison points for the online Mahalanobis detector in terms of:

- how often alerts are raised (false alarm characteristics),
- whether certain anomalies are detected earlier or exclusively by one approach.

---

## 3. Demo

The main entry point for interactive exploration is the **Streamlit app** `src/app.py`, which provides an end-to-end demonstration of the anomaly detection pipeline.

## UI Interface

## üìà Live Stream

The app is organised into two main tabs. The first tab, **Live Stream**, provides an interactive view of the calibration time series and anomaly detection results.

### Data source

Toggle between:

- **Synthetic (simulated)**: uses `data/calibration_stream.csv`
- **Real (Qiskit calibration)**: uses `data/real_calibration_stream.csv`

### Detector configuration

**Online model (Mahalanobis-based):**

- Window size  
- Minimum warm-up length  
- Contamination (target anomaly rate)

**Baselines:**

- Static threshold parameter **k** in ¬±k¬∑œÉ  
- |z|-score threshold

### Visualisation

The app streams through the calibration time series point-by-point and plots the selected metric over time with:

- Grey line: raw metric evolution  
- Blue circles: anomalies flagged by the **online Mahalanobis model**  
- Blue triangles: anomalies flagged by the **static ¬±k¬∑œÉ baseline**  
- Blue crosses: anomalies flagged by the **|z|-score baseline**

A side panel shows, at each step:

- Index, timestamp, data source  
- Metric value, online score, online threshold  
- Anomaly flags for all three detectors, using emoji coding:
  - üü¶ = flagged  
  - ‚¨ú = not flagged  

Streaming can be started and stopped via dedicated buttons.

---

## üìä Run Summary

After a run, the **Run Summary** tab aggregates the processed stream into a table with columns such as:

- `timestamp`  
- The selected metric (e.g., `T1_q0`)  
- `online_score`, `online_threshold`  
- `online_flag`, `static_flag`, `zscore_flag`  

A **‚ÄúDownload full run as CSV‚Äù** button allows exporting the entire log for offline analysis, integration with notebooks, or comparison across runs.


## 3.1 Future Work

This repository is intended as a prototype rather than a complete monitoring solution. Several natural extensions could be pursued in a more formal study:

---

### 1. Topology-Aware Modelling

- Incorporate device connectivity (e.g., heavy-hex graphs) into the anomaly model.  
- Explore graph-based features or structured covariance models that respect qubit coupling and layout.

---

### 2. Richer Online Methods

Evaluate alternative online detectors, such as:

- Streaming PCA and subspace distance measures  
- Online autoencoders  
- Robust covariance estimators  
- Change-point detection algorithms  

---

### 3. Labelled Event Correlation

Align detected anomalies with known operational events, for example:

- Calibration failures  
- Sudden increases in error rates  
- Maintenance intervals  

Assess whether the online model provides earlier or more selective warnings than baseline methods when such labels are available.

---

### 4. Operational Integration

Extend the dashboard to support:

- Qubit-level anomaly heatmaps  
- Alerts that inform job routing or qubit avoidance strategies  
- Simple policies for deciding when to trigger recalibration

---

### 5. Benchmarking and Reproducibility

- Curate or release standardised calibration datasets (synthetic and real).  
- Define a set of benchmark tasks for anomaly detection in quantum hardware monitoring.  
- Enable systematic comparison between different anomaly detection methods under common conditions.


### 3.2 Running the demo

1. **Install dependencies**

```bash
git clone https://github.com/freelansire/Quantum-Calib-Anomaly.git
cd Quantum-Calib-Anomaly

pip install -r requirements.txt


## How to Cite

If you use **Online Anomaly Detection in Quantum Device Calibration Streams** in research, teaching, or derivative work, please cite the repository.

## Suggested citation (APA-style)

Orokpo, S.M.(2025). Online Anomaly Detection in Quantum Device Calibration Streams   (Version 0.1.0) [Software]. GitHub. https://github.com/freelansire/Quantum-Calib-Anomaly
  
## BibTeX

```bibtex
@software{orokpo_quantum_calibration_streams_2025,
  author       = {Samuel Moses Orokpo},
  title        = {Online Anomaly Detection in Quantum Device Calibration Streams},
  year         = {2025},
  version      = {1.0.1},
  url          = {https://github.com/freelansire/Quantum-Calib-Anomaly},
